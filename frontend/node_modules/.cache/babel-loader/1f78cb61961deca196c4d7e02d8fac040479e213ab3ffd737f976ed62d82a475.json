{"ast":null,"code":"import store from './store';\nimport { createApp, h } from 'vue';\nimport App from './App.vue';\nimport router from './router';\nimport axios from 'axios';\nimport Vuex from 'vuex';\nimport '@fortawesome/fontawesome-free/js/all';\naxios.defaults.baseURL = 'http://localhost:8001';\n\n// axios.defaults.baseURL = 'http://localhost:8001/api/v1'\n// TODO \n// store.dispatch(\"token_storage\")\n\n// REFRESH TOKEN\nasync function refreshToken() {\n  const refreshToken = localStorage.getItem('refresh_token');\n  try {\n    const responce = await axios.post('/api/v1/auth/refresh', {\n      token: refreshToken\n    });\n    // TODO new refresh token !!!\n    const newTokens = {\n      'newAccessToken': responce.data.accessToken,\n      'newRefreshToken': responce.data.refreshToken\n    };\n    return newTokens;\n  } catch (error) {\n    console.error('Unable to refresh token', error);\n    throw error;\n  }\n}\n\n// request interceptor\naxios.interceptors.request.use(async config => {\n  if (!config.headers.skipAuthorization) {\n    const accessToken = localStorage.getItem('access_token');\n    if (accessToken) {\n      config.headers['Authorization'] = `Bearer ${accessToken}`;\n    }\n  }\n  // Remove the custom flag before sending the request\n  delete config.headers.skipAuthorization;\n  return config;\n}, error => {\n  Promise.reject(error);\n});\n\n// response interceptor\naxios.interceptors.response.use(responce => {\n  return responce;\n}, async error => {\n  const originalRequest = error.config;\n  if (error.responce.status === 401 && !originalRequest._retry) {\n    originalRequest._retry = true;\n    try {\n      const newTokens = await refreshToken();\n      axios.defaults.headers.common['Authorization'] = `Bearer ${newTokens.newAccessToken}`;\n      originalRequest.headers['Authorization'] = `Bearer ${newTokens.newAccessToken}`;\n      localStorage.setItem(\"access_token\", newTokens.newAccessToken);\n      localStorage.setItem(\"refresh_token\", newTokens.newRefreshToken);\n      // localStorage.setItem(\"username\", newTokens.newUsername) \n\n      return axios(originalRequest);\n    } catch (err) {\n      // error by refresh token\n      console.log('Token refresh failed', err);\n      return Promise.reject(err);\n    }\n  }\n  return Promise.reject(error);\n});\nconst app = createApp(App);\napp.config.devtools = true;\napp.config.globalProperties.$axios = axios;\n\n// create selectable style for dynamic css variables\napp.component(\"v-style\", {\n  render() {\n    return h(\"style\", {}, this.$slots.default());\n  }\n});\napp.use(store).use(router).use(Vuex).mount('#app');","map":{"version":3,"names":["store","createApp","h","App","router","axios","Vuex","defaults","baseURL","refreshToken","localStorage","getItem","responce","post","token","newTokens","data","accessToken","error","console","interceptors","request","use","config","headers","skipAuthorization","Promise","reject","response","originalRequest","status","_retry","common","newAccessToken","setItem","newRefreshToken","err","log","app","devtools","globalProperties","$axios","component","render","$slots","default","mount"],"sources":["/home/nexoc/JS/frontend/frontend-vue/src/main.js"],"sourcesContent":["\nimport store from './store'\nimport { createApp, h } from 'vue'\nimport App from './App.vue'\nimport router from './router'\nimport axios from 'axios'\nimport Vuex from 'vuex'\n\nimport '@fortawesome/fontawesome-free/js/all'\n\n\naxios.defaults.baseURL = 'http://localhost:8001'\n\n// axios.defaults.baseURL = 'http://localhost:8001/api/v1'\n// TODO \n// store.dispatch(\"token_storage\")\n\n\n// REFRESH TOKEN\nasync function refreshToken() {\n    const refreshToken= localStorage.getItem('refresh_token');\n\n    try {\n        const responce = await axios.post('/api/v1/auth/refresh', {\n            token: refreshToken\n        });\n        // TODO new refresh token !!!\n        const newTokens = {\n            'newAccessToken' : responce.data.accessToken,\n            'newRefreshToken' : responce.data.refreshToken\n        }\n        return newTokens;\n    } catch (error) {\n        console.error('Unable to refresh token', error);\n        throw error;\n    }\n}\n\n// request interceptor\naxios.interceptors.request.use(\n    async config => {\n\n        if (!config.headers.skipAuthorization) {\n            const accessToken = localStorage.getItem('access_token');\n        if(accessToken) {            \n            config.headers['Authorization'] = `Bearer ${accessToken}`;         \n        }\n    }\n        // Remove the custom flag before sending the request\n        delete config.headers.skipAuthorization;\n        return config;\n    },\n    error => {\n        Promise.reject(error);\n    }\n);\n\n// response interceptor\naxios.interceptors.response.use(\n    responce => {\n        return responce;\n    },\n    async error =>\n     {\n        const originalRequest = error.config;\n\n        if (error.responce.status === 401 && !originalRequest._retry) {\n            originalRequest._retry = true;\n            try {\n                const newTokens = await refreshToken();\n                axios.defaults.headers.common['Authorization'] = `Bearer ${newTokens.newAccessToken}`;\n                originalRequest.headers['Authorization'] = `Bearer ${newTokens.newAccessToken}`;\n                localStorage.setItem(\"access_token\", newTokens.newAccessToken)\n                localStorage.setItem(\"refresh_token\", newTokens.newRefreshToken)\n                // localStorage.setItem(\"username\", newTokens.newUsername) \n\n                return axios(originalRequest);\n                \n            } catch(err) {\n                // error by refresh token\n                console.log('Token refresh failed', err);\n                return Promise.reject(err);\n            }\n        }\n\n        return Promise.reject(error);\n    }\n);\n\n\nconst app = createApp(App);\n\n\napp.config.devtools = true;\napp.config.globalProperties.$axios = axios;\n\n// create selectable style for dynamic css variables\napp.component(\"v-style\", {\n  render () { return h(\"style\", {}, this.$slots.default()); }\n});\n\n\napp.use(store).use(router).use(Vuex).mount('#app')\n"],"mappings":"AACA,OAAOA,KAAK,MAAM,SAAS;AAC3B,SAASC,SAAS,EAAEC,CAAC,QAAQ,KAAK;AAClC,OAAOC,GAAG,MAAM,WAAW;AAC3B,OAAOC,MAAM,MAAM,UAAU;AAC7B,OAAOC,KAAK,MAAM,OAAO;AACzB,OAAOC,IAAI,MAAM,MAAM;AAEvB,OAAO,sCAAsC;AAG7CD,KAAK,CAACE,QAAQ,CAACC,OAAO,GAAG,uBAAuB;;AAEhD;AACA;AACA;;AAGA;AACA,eAAeC,YAAYA,CAAA,EAAG;EAC1B,MAAMA,YAAY,GAAEC,YAAY,CAACC,OAAO,CAAC,eAAe,CAAC;EAEzD,IAAI;IACA,MAAMC,QAAQ,GAAG,MAAMP,KAAK,CAACQ,IAAI,CAAC,sBAAsB,EAAE;MACtDC,KAAK,EAAEL;IACX,CAAC,CAAC;IACF;IACA,MAAMM,SAAS,GAAG;MACd,gBAAgB,EAAGH,QAAQ,CAACI,IAAI,CAACC,WAAW;MAC5C,iBAAiB,EAAGL,QAAQ,CAACI,IAAI,CAACP;IACtC,CAAC;IACD,OAAOM,SAAS;EACpB,CAAC,CAAC,OAAOG,KAAK,EAAE;IACZC,OAAO,CAACD,KAAK,CAAC,yBAAyB,EAAEA,KAAK,CAAC;IAC/C,MAAMA,KAAK;EACf;AACJ;;AAEA;AACAb,KAAK,CAACe,YAAY,CAACC,OAAO,CAACC,GAAG,CAC1B,MAAMC,MAAM,IAAI;EAEZ,IAAI,CAACA,MAAM,CAACC,OAAO,CAACC,iBAAiB,EAAE;IACnC,MAAMR,WAAW,GAAGP,YAAY,CAACC,OAAO,CAAC,cAAc,CAAC;IAC5D,IAAGM,WAAW,EAAE;MACZM,MAAM,CAACC,OAAO,CAAC,eAAe,CAAC,GAAG,UAAUP,WAAW,EAAE;IAC7D;EACJ;EACI;EACA,OAAOM,MAAM,CAACC,OAAO,CAACC,iBAAiB;EACvC,OAAOF,MAAM;AACjB,CAAC,EACDL,KAAK,IAAI;EACLQ,OAAO,CAACC,MAAM,CAACT,KAAK,CAAC;AACzB,CACJ,CAAC;;AAED;AACAb,KAAK,CAACe,YAAY,CAACQ,QAAQ,CAACN,GAAG,CAC3BV,QAAQ,IAAI;EACR,OAAOA,QAAQ;AACnB,CAAC,EACD,MAAMM,KAAK,IACV;EACG,MAAMW,eAAe,GAAGX,KAAK,CAACK,MAAM;EAEpC,IAAIL,KAAK,CAACN,QAAQ,CAACkB,MAAM,KAAK,GAAG,IAAI,CAACD,eAAe,CAACE,MAAM,EAAE;IAC1DF,eAAe,CAACE,MAAM,GAAG,IAAI;IAC7B,IAAI;MACA,MAAMhB,SAAS,GAAG,MAAMN,YAAY,CAAC,CAAC;MACtCJ,KAAK,CAACE,QAAQ,CAACiB,OAAO,CAACQ,MAAM,CAAC,eAAe,CAAC,GAAG,UAAUjB,SAAS,CAACkB,cAAc,EAAE;MACrFJ,eAAe,CAACL,OAAO,CAAC,eAAe,CAAC,GAAG,UAAUT,SAAS,CAACkB,cAAc,EAAE;MAC/EvB,YAAY,CAACwB,OAAO,CAAC,cAAc,EAAEnB,SAAS,CAACkB,cAAc,CAAC;MAC9DvB,YAAY,CAACwB,OAAO,CAAC,eAAe,EAAEnB,SAAS,CAACoB,eAAe,CAAC;MAChE;;MAEA,OAAO9B,KAAK,CAACwB,eAAe,CAAC;IAEjC,CAAC,CAAC,OAAMO,GAAG,EAAE;MACT;MACAjB,OAAO,CAACkB,GAAG,CAAC,sBAAsB,EAAED,GAAG,CAAC;MACxC,OAAOV,OAAO,CAACC,MAAM,CAACS,GAAG,CAAC;IAC9B;EACJ;EAEA,OAAOV,OAAO,CAACC,MAAM,CAACT,KAAK,CAAC;AAChC,CACJ,CAAC;AAGD,MAAMoB,GAAG,GAAGrC,SAAS,CAACE,GAAG,CAAC;AAG1BmC,GAAG,CAACf,MAAM,CAACgB,QAAQ,GAAG,IAAI;AAC1BD,GAAG,CAACf,MAAM,CAACiB,gBAAgB,CAACC,MAAM,GAAGpC,KAAK;;AAE1C;AACAiC,GAAG,CAACI,SAAS,CAAC,SAAS,EAAE;EACvBC,MAAMA,CAAA,EAAI;IAAE,OAAOzC,CAAC,CAAC,OAAO,EAAE,CAAC,CAAC,EAAE,IAAI,CAAC0C,MAAM,CAACC,OAAO,CAAC,CAAC,CAAC;EAAE;AAC5D,CAAC,CAAC;AAGFP,GAAG,CAAChB,GAAG,CAACtB,KAAK,CAAC,CAACsB,GAAG,CAAClB,MAAM,CAAC,CAACkB,GAAG,CAAChB,IAAI,CAAC,CAACwC,KAAK,CAAC,MAAM,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}